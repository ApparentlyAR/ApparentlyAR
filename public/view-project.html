<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Project - ApparentlyAR</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="global.css">
</head>
<body class="text-gray-800">
    <div id="header-container"></div>

    <main class="max-w-screen-xl mx-auto p-4 sm:p-6 lg:p-8">
        <nav class="flex mb-6" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a id="breadcrumb-dashboard-link" href="#" class="text-sm font-medium text-gray-500 hover:text-gray-700">My Project</a>
                </li>
                <li>
                    <div class="flex items-center">
                        <svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                        <span id="breadcrumb-project-name" class="text-sm font-medium text-gray-900">Loading...</span>
                    </div>
                </li>
            </ol>
        </nav>
        <div class="flex items-center gap-4 mb-4">
            <h2 id="project-title" class="text-4xl font-bold text-gray-900">Loading Project...</h2>
            <button id="edit-project-button" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-6.071 7.071L4 14.172V17h2.828l6.172-6.172-2.828-2.828z" /></svg>
                Edit
            </button>
        </div>
        <p id="project-description" class="text-gray-600 mb-10 w-full max-w-2xl">Loading description...</p>
        <h3 class="text-2xl font-bold text-gray-900 mb-4">Data Panel</h3>
        <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8">
            <div class="data-panel-table-container">
                <table id="data-table" class="min-w-full divide-y divide-gray-200"></table>
            </div>
        </div>
        <div class="text-right">
            <button class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" onclick="window.location.href='blockly-demo.html'">
                Simulate Project
            </button>
        </div>
    </main>
    <script>
        // --- Universal Dropdown & Header Logic ---
        function closeAllDropdowns() {
            document.querySelectorAll('.project-dropdown').forEach(menu => menu.classList.add('hidden'));
        }

        function toggleUserMenu(event) {
            event.stopPropagation();
            const menu = document.getElementById('user-menu');
            const isHidden = menu.classList.contains('hidden');
            closeAllDropdowns();
            if (isHidden) menu.classList.remove('hidden');
        }

        function logout(event) {
            event.preventDefault();
            console.log("User logged out.");
            window.location.href = '/';
        }

        window.addEventListener('click', function (event) {
            if (!event.target.closest('.dropdown-toggle')) {
                closeAllDropdowns();
            }
        });

        // --- Page-Specific Loading & API Logic ---
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        async function loadProjectDetails() {
            const projectId = getQueryParam('id');
            const role = getQueryParam('role');
            const editButton = document.getElementById('edit-project-button');

            if (role === 'student') {
                if (editButton) editButton.style.display = 'none';
            }

            if (!projectId) { /* ... same as before ... */ return; }
            
            if (role === 'teacher' && editButton) {
                editButton.onclick = function() { window.location.href = 'edit-project.html?id=' + projectId; };
            }

            try {
                const response = await fetch(`/api/projects/${projectId}`);
                if (!response.ok) throw new Error('Failed to fetch project details.');
                const project = await response.json();
                document.getElementById('breadcrumb-project-name').textContent = project.name;
                document.getElementById('project-title').textContent = project.name;
                document.getElementById('project-description').textContent = project.description || 'No description available for this project.';
            } catch (error) { /* ... same as before ... */ }
        }

        // Load Header and set dynamic links
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                const role = getQueryParam('role');
                const dashboardLink = document.getElementById('header-dashboard-link');
                if (dashboardLink) {
                    dashboardLink.href = role === 'student' ? 'student-dashboard.html' : 'teacher-dashboard.html';
                }
            });

        document.addEventListener('DOMContentLoaded', loadProjectDetails);
    </script>
</body>
</html>