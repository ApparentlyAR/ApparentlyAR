<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Project - ApparentlyAR</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="global.css">
</head>
<body class="text-gray-800">

    <!-- Header imported from header.html -->
    <div id="header-container"></div>
    <script>
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading header:', error);
            });
    </script>

    <main class="max-w-screen-xl mx-auto p-4 sm:p-6 lg:p-8">
        <nav class="flex mb-6" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="teacher-dashboard.html" class="text-sm font-medium text-gray-500 hover:text-gray-700">My Project</a>
                </li>
                <li>
                    <div class="flex items-center">
                        <svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                        <span id="breadcrumb-project-name" class="text-sm font-medium text-gray-900">Loading...</span>
                    </div>
                </li>
            </ol>
        </nav>

        <div class="flex items-center gap-4 mb-4">
            <h2 id="project-title" class="text-4xl font-bold text-gray-900">Loading Project...</h2>
            <button id="edit-project-button" onclick="window.location.href='edit-project.html?id=' + projectId" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <!-- pencil icon -->
                Edit
            </button>
        </div>

        <p id="project-description" class="text-gray-600 mb-10 w-full max-w-2xl">
            Loading description...
        </p>

        <h3 class="text-2xl font-bold text-gray-900 mb-4">Data Panel</h3>
        <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-8">
            <div class="data-panel-table-container">
                <table id="data-table" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50" id="table-header">
                        <!-- Headers will be populated dynamically -->
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="table-body">
                        <!-- Data rows will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="text-right">
            <button class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" onclick="window.location.href='blockly-demo.html'">
                Simulate Project
            </button>
        </div>
    </main>

    <script>
        // Function to get query parameters from the URL
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // --- Main Function to Load Project Details ---
        async function loadProjectDetails() {
            const projectId = getQueryParam('id');
            
            if (!projectId) {
                // If no ID is found, redirect to dashboard or show an error
                document.getElementById('project-title').textContent = 'Error: No Project ID Provided';
                document.getElementById('project-description').textContent = 'Please select a project from the dashboard.';
                document.getElementById('breadcrumb-project-name').textContent = 'Error';
                document.getElementById('edit-project-button').style.display = 'none'; // Hide edit button
                return;
            }

            // Update the edit button link
            document.getElementById('edit-project-button').onclick = function() { 
                window.location.href = 'edit-project.html?id=' + projectId; 
            };


            try {
                // Fetch project details from your API
                const response = await fetch(`/api/projects/${projectId}`); // Assuming an API endpoint like /api/projects/1
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error(`Project with ID ${projectId} not found.`);
                    }
                    throw new Error('Failed to fetch project details.');
                }
                const project = await response.json();

                // Populate the page with fetched data
                document.getElementById('breadcrumb-project-name').textContent = project.name;
                document.getElementById('project-title').textContent = project.name;
                document.getElementById('project-description').textContent = project.description || 'No description available for this project.';
                
                // Populate the data table with CSV data if available
                if (project.csvHeaders && project.csvData) {
                    populateTable(project.csvHeaders, project.csvData);
                } else {
                    // If no CSV data is available, show a message
                    const tableHeader = document.getElementById('table-header');
                    const tableBody = document.getElementById('table-body');
                    
                    tableHeader.innerHTML = '';
                    tableBody.innerHTML = '<tr><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" colspan="100">No CSV data available for this project</td></tr>';
                    
                    // Add a default header row
                    const headerRow = document.createElement('tr');
                    const headerCell = document.createElement('th');
                    headerCell.className = 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider';
                    headerCell.textContent = 'No Data Available';
                    headerCell.setAttribute('colspan', '100');
                    headerRow.appendChild(headerCell);
                    tableHeader.appendChild(headerRow);
                }
                
            } catch (error) {
                console.error('Error loading project details:', error);
                document.getElementById('breadcrumb-project-name').textContent = 'Error';
                document.getElementById('project-title').textContent = 'Error Loading Project';
                document.getElementById('project-description').textContent = `Could not load project details. ${error.message || 'Please try again.'}`;
                document.getElementById('edit-project-button').style.display = 'none'; // Hide edit button
            }
        }
        
        // Function to populate the table with CSV data
        function populateTable(headers, data) {
            const tableHeader = document.getElementById('table-header');
            const tableBody = document.getElementById('table-body');
            
            // Clear existing content
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            
            // Create header row
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.scope = 'col';
                th.className = 'px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider';
                th.textContent = header;
                headerRow.appendChild(th);
            });
            tableHeader.appendChild(headerRow);
            
            // Create data rows
            data.forEach(row => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                    td.textContent = row[header] || '';
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }

        document.addEventListener('DOMContentLoaded', loadProjectDetails);
    </script>
</body>
</html>